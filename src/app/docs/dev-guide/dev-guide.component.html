<div class="bd-main">
    <div class="bd-toc mt-4 mb-5 my-md-0 ps-xl-3 mb-lg-5 text-muted">
        <strong class="d-block h6 my-2 pb-2 border-bottom">On this page</strong>
        <nav id="TableOfContents">
            <ul>
                <li>
                    <a [routerLink]="['.']" fragment="apikey">apiKey</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="user-agent">UserAgent</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="session">Session</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="h1__1298403728">Contacts : Presence,
                        Groups</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="conversation">Conversation</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="h1__535264398">Moderation</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="local-streams">Local Streams</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="remote-streams">Remote Streams</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="stream-display">Stream display</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="stream-capabilities">Stream capabilities</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="qos-statistics">QoS Statistics</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="speaker-detection">Speaker Detection</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="mute">Video/Audio Mute</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="whiteboard">Whiteboard</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="recording">Recording</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="chat-messages">Chat messages</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="device-control">Device Control</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="background-subtraction">Background
                        subtraction</a>
                </li>
                <li>
                    <a [routerLink]="['.']" fragment="good-practices">Good practices</a>
                    <ul>
                        <li>
                            <a href="#sub">Sub</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
    <div class="bd-content">
        <div class="container">
            <p class="mt-5 fs-5">
                This guide covers all concepts and features you may require to develop your communication <strong>client
                    application</strong> with <strong>ApiRTC</strong>.
            </p>
            <h1 id="apiKey" class="mt-5">
                apiKey
            </h1>
            <p>
                The <strong>apiKey</strong> is a 32 characters string associated with an <strong>Enterprise</strong>. It
                allows associating <strong>ApiRTC</strong> usage with your project for quota and billing.
            </p>
            <p>
                An <strong>apiKey</strong> is required to start using the client <strong>ApiRTC APIs</strong>.
            </p>
            <div class="alert alert-info d-flex align-items-center" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Info:">
                    <use xlink:href="#info-fill"></use>
                </svg>
                <div>
                    Create an account and get an <strong>apiKey</strong> from <a href="https://www.apirtc.com"
                        title="Get apiKey" target="_blank" rel="noopener">https://www.apirtc.com</a>
                </div>
            </div>
            <h1 id="user-agent" class="mt-5">
                UserAgent
            </h1>
            <p>
                The <code>UserAgent</code> is an entrypoint to <strong>ApiRTC</strong>. This is the first object to
                instantiate. It represents the local user that will participate to communications.
            </p>
            <p class="text-center mt-3">
                There are two ways to instantiate a <code>UserAgent</code> :
            </p>
            <div class="row">
                <div class="col">
                    <div class="card border-secondary">
                        <div class="card-body text-secondary">
                            <h3 class="card-title">
                                with apiKey
                            </h3>
                            <div class="card-text">
                                <p>
                                    This method is useful to use <strong>ApiRTC</strong> anonymously, or with external
                                    user management.
                                </p>
                                <p>
                                    In this case the <code>uri</code> is <strong>apiKey</strong> prefixed with "apzkey:"
                                    string.
                                </p>
                                <app-codenav [lang]="lang" [code]="useragent_apikey" (onLang)="lang=$event">
                                </app-codenav>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card border-secondary">
                        <div class="card-body text-secondary">
                            <h3 class="card-title">
                                with username
                            </h3>
                            <div class="card-text">
                                <p>
                                    This method is useful to further authenticate with
                                    <strong>ApiRTC</strong>&nbsp;<strong>User</strong> management.
                                </p>
                                <p>
                                    In this case the <code>uri</code> is <strong>username</strong> prefixed with
                                    "apizee:" string.
                                </p>
                                <app-codenav [lang]="lang" [code]="useragent_apirtc" (onLang)="lang=$event">
                                </app-codenav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h2 class="mt-3">
                UserData
            </h2>
            <p>
                <code>UserData</code> is a class that holds a data object to store values associated to a
                <code>UserAgent</code>. Make sure to call <code>UserData.setProp(key, value)</code> to set a property.
            </p>
            <p>
                Once connected to <code>Session</code>, call <code>userData.setToSession()</code> to make other
                connected peers notified of <code>UserData</code> properties change through the
                <code>contactListUpdate</code> event.
            </p>
            <p>
                For that purpose, the data object associated to <code>Session</code>'s <code>contactListUpdate</code>
                event, <code>updatedContacts</code> will carry a <code>userDataChanged</code> array property of
                <code>Contact</code>s for which <code>UserData</code> has changed.
            </p>
            <h2>
                MediaDevices
            </h2>
            <p>
                <code>UserAgent</code>'s <code>mediaDeviceChanged</code> event can be listened to in order to get
                notified of the list of available devices available to the browser:
            </p>
            <app-codenav [lang]="lang" [code]="mediaDeviceChanged" (onLang)="lang=$event"></app-codenav>
            <p class="mt-3">
                Here is what the <code>mediaDevices</code> object looks like:
            </p>
            <pre><code [highlight]="mediaDevices_json" [languages]="['json']"></code></pre>
            <p class="mt-3">
                This is useful to propose a list of available media devices to the user.
            </p>
            <h1 id="session" class="mt-5">
                Session
            </h1>
            <p>
                The <code>Session</code> is obtained when connecting to the ApiRTC platform.
            </p>
            <p>
                A <code>Session</code> with <strong>ApiRTC</strong> platform needs to be established in order to access
                connected features of <strong>ApiRTC</strong> such as chat or video conferencing.
            </p>
            <p>
                This is done through the <code>UserAgent.register();</code> method.
            </p>
            <p>
                The <code>UserAgent.register(options);</code> can take an <code>options</code> parameter that can be
                used to control the authentication mecanism.
            </p>
            <p>
                Note that the required authentication must be configured by <strong>Enterprise</strong> (thus by
                <strong>apiKey</strong>), from your account panel (TODO: give link).
            </p>
            <h2>
                Authentication
            </h2>
            <p>
                Getting a Session supports the following authentication mecanisms :
            </p>
            <div class="row">
                <div class="col-4">
                    <div class="card border-secondary mb-3">
                        <div class="card-body text-secondary">
                            <h3 class="card-title">
                                No auth
                            </h3>
                            <app-codenav [lang]="lang" [code]="register_noauth" (onLang)="lang=$event"></app-codenav>
                            <p class="card-text">
                                <br />
                                on a <code>UserAgent</code> created with <strong>apiKey</strong>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col-4">
                    <div class="card border-secondary mb-3">
                        <div class="card-body text-secondary">
                            <h3 class="card-title">
                                External user management
                            </h3>
                            <div class="card-text">
                                <div class="row">
                                    <div class="col">
                                        <div class="card border-secondary mb-3">
                                            <div class="card-body text-secondary">
                                                <h3 class="card-title" id="h5__278552043">
                                                    JWT (JSON Web Token)
                                                </h3>
                                                <app-codenav [lang]="lang" [code]="register_jwt" (onLang)="lang=$event">
                                                </app-codenav>
                                                <p class="card-text">
                                                    on a <code>UserAgent</code> created with <strong>apiKey</strong>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="card border-secondary mb-3">
                                            <div class="card-body text-secondary">
                                                <h3 class="card-title">
                                                    3rdParty Auth server
                                                </h3>
                                                <app-codenav [lang]="lang" [code]="register_3rdparty"
                                                    (onLang)="lang=$event"></app-codenav>
                                                <p class="card-text">
                                                    &nbsp;on a <code>UserAgent</code> created with
                                                    <strong>apiKey</strong>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card border-info mb-3">
                        <div class="card-body text-secondary">
                            <h3 class="card-title">
                                ApiRTC user management
                            </h3>
                        </div>
                        <div class="card-body text-secondary">
                            <app-codenav [lang]="lang" [code]="register_apirtc" (onLang)="lang=$event"></app-codenav>
                            <p class="card-text">
                                on a <code>UserAgent</code> created with <strong>username</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <h1 class="mt-5">
                Contacts : Presence, Groups
            </h1>
            <p>
                In an <strong>ApiRTC</strong> client application, remote participants are <code>Contact</code>s.
            </p>
            <p>
                Listening on <code>Session.contactListUpdate</code> event notifies on <code>Contact</code>, connected
                with to same <strong>Enterprise</strong>(<strong>apiKey</strong>), that joined, left, or for which
                <code>UserData</code> changed.
                (joinedGroup leftGroup userDataChanged)
            </p>
            <p>
                This is known as the <strong>User</strong> <strong>presence</strong> feature.
            </p>
            <p>
                A notion of <strong>groups</strong> comes with this feature for better control.
            </p>
            <h1 id="conversation" class="mt-5">
                Conversation
            </h1>
            <p>
                A <code>Conversation</code> is the way to gather participants to exchange medias. It can be text
                message, audio/video streams, files...
            </p>
            <p>
                Whenever there are 2 participants or more, a <code>Conversation</code> takes place.
            </p>
            <h2>
                getOrCreate
            </h2>
            <p>
                To get a <code>Conversation</code> instance, the method
                <code>Session.getOrCreateConversation(name, options)</code> shall be used.
            </p>
            <p>
                Possible <code>options</code> are :
            </p>
            <pre><code [highlight]="getOrCreateConversation__options" [languages]="['json']"></code></pre>
            <p>
                <code>meshModeEnabled</code> enables the mesh mode (otherwise SFU star topoplogy is used by default).
                The streams
                exchanges will remain in this mode until :
            </p>
            <ul>
                <li>
                    the number of participant goes over 4,
                </li>
                <li>
                    or too many packet loss is detected for one participant,
                </li>
            </ul>
            then the <strong>Conversation</strong> will automatically switch to star topology mode using ApiRTC SFUs
            infrastructure.
            <p>
            </p>
            <div class="alert alert-info d-flex align-items-center" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Info:">
                    <use xlink:href="#info-fill"></use>
                </svg>
                <div>
                    Check <a routerLink="../technical-concepts" title="link to SFUs">Technical Concepts</a> to learn
                    about how <strong>ApiRTC</strong> handles
                    small and large <code>Conversation</code>s.
                </div>
            </div>
            <p>
                Setting both <code>meshModeEnabled</code> and <code>meshOnlyEnabled</code> to <code>true</code> forces
                the <code>Conversation</code> to remain mesh only.
            </p>
            <h2>
                Join
            </h2>
            <p>
                <code>Conversation.join</code> method makes the local user represented by the <code>UserAgent</code>
                that got (or created) the <code>Conversation</code> instance (through the session it registered to)
                actually join.
            </p>
            <p>
                <code>join()</code> actually returns a promise. <strong>Conversation</strong> will be joined when the
                promise resolves. The resolution may depend on moderation.
            </p>
            <h2>
                Leave
            </h2>
            <p>
                <code>Conversation.leave</code> method makes the local user represented by the <code>UserAgent</code>
                leave the <strong>conversation</strong>.
            </p>
            <h2>
                Moderation
            </h2>
            <p>
                <strong>Moderation</strong> is feature that allows moderators to control who participates to a
                <code>Conversation</code>
            </p>
            <p>
                TODO : explain how this can be achieve (when it is actually developped)
            </p>
            <h2>
                accept/decline...
            </h2>
            <h2>
                eject...
            </h2>
            <p>
                .. In the context of a moderated Conversation, the join will resolve only when a moderator accepts the
                join request.
            </p>
            <h1 class="mt-5" id="local-streams">
                Local Streams
            </h1>
            <p>
                Acquiring <strong>local stream</strong> is done throught the
                <code>UserAgent.createStream(options)</code> method.
            </p>
            <p>
                Possible <code>options</code> are :
            </p>
            <pre><code [highlight]="createStream_options" [languages]="['json']"></code></pre>
            <p>
                <code>constraints</code> is of type <a
                    href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints" target="_blank"
                    rel="noopener">MediaStreamConstraints</a>
            </p>
            <h1 class="mt-5" id="remote-streams">
                Remote Streams
            </h1>
            <h2>
                Publish
            </h2>
            <p>
                Publishing a <strong>local stream</strong> makes it available for remote peer participants to subscribe
                and view it.
            </p>
            <p>
                The <strong>local user</strong> (<code>UserAgent</code>) must have joined the conversation to publish a
                <strong>stream</strong>.
            </p>
            <app-codenav [lang]="lang" [code]="publish" (onLang)="lang=$event"></app-codenav>
            <h3>
                PublishOptions
            </h3>
            <p>
                <code>Conversation.publish(stream, options)</code> can take optionally take <code>PublishOptions</code>
                second parameter object to control publication.
                Please check reference for details on <a
                    href="https://dev.apirtc.com/reference/global.html#PublishOptions" target="_blank"
                    rel="noopener">PublishOptions</a>
            </p>
            <h2>
                Unpublish
            </h2>
            <p>
                Unpublishing a <strong>local stream</strong> makes it unavailable for remote peer participants to
                subscribe and stops sending <strong>media stream</strong> to peers.
            </p>
            <app-codenav [lang]="lang" [code]="unpublish" (onLang)="lang=$event"></app-codenav>
            <h2>
                Handle remote streams availability
            </h2>
            <p>
                <strong>ApiRTC</strong> notifies when stream availability changes through the
                <code>streamListChanged</code> event.
            </p>
            <p>
                This event is triggered once for each existing <strong>stream</strong>, and then again every time a new
                <strong>stream</strong> is published to the <strong>conversation</strong>.
            </p>
            <div class="alert alert-warning" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Warning:">
                    <use xlink:href="#exclamation-triangle-fill"></use>
                </svg>
                <span>The information carried by the event is <code>StreamInfo</code>: this is not a <code>Stream</code>
                    yet.</span>
            </div>
            <app-codenav [lang]="lang" [code]="streamListChanged" (onLang)="lang=$event"></app-codenav>
            <p>
                The <code>streamInfo.contact.getId()</code> and <code>streamInfo.streamId</code> can be useful to
                identify remote <strong>peer</strong> and <strong>stream</strong>.
            </p>
            <h2>
                Subscribe
            </h2>
            <p>
                A <strong>remote stream</strong> is subscribed to using the
                <code>Conversation.subscribeToStream(streamId)</code> method. It takes the id of stream provided in the
                <code>StreamInfo</code> data object:
            </p>
            <app-codenav [lang]="lang" [code]="subscribe" (onLang)="lang=$event"></app-codenav>
            <h3>
                SubscribeOptions
            </h3>
            <p>
                <code>Conversation.subscribeToStream(streamId, options)</code> can take optionally take
                <code>SubscribeOptions</code> second parameter object to control subscription.
                Please check reference for details on <a
                    href="https://dev.apirtc.com/reference/global.html#SubscribeOptions" target="_blank"
                    rel="noopener">SubscribeOptions</a>
            </p>
            <h2>
                Unsubscribe
            </h2>
            <p>
                Unsubscribing to a <strong>remote stream</strong> is done by the
                <code>Conversation.unsubscribeToStream(streamId)</code> method.
            </p>
            <app-codenav [lang]="lang" [code]="unsubscribe" (onLang)="lang=$event"></app-codenav>
            <h2>
                Manage media streams
            </h2>
            <p>
                Once a <strong>stream</strong> has been subscribed, <strong>ApiRTC</strong> notifies with an actual
                <code>Stream</code> instance through the <code>streamAdded</code> event.
            </p>
            <p>
                This event is triggered every time the actual media stream is available to be displayed.
            </p>
            <app-codenav [lang]="lang" [code]="streamAdded" (onLang)="lang=$event"></app-codenav>
            <p>
                Whenever a <code>media stream</code> becomes unavailable, <strong>ApiRTC</strong> notifies the
                <strong>conversation</strong> with a <code>streamRemoved</code> event.
            </p>
            <app-codenav [lang]="lang" [code]="streamRemoved" (onLang)="lang=$event"></app-codenav>
            <div class="alert alert-warning" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Warning:">
                    <use xlink:href="#exclamation-triangle-fill"></use>
                </svg>
                <span>
                    A <code>media stream</code> may encounter technical issues, or meet network optimization requiring
                    to change the actual <code>Stream</code> instance.
                    In this case <code>streamRemoved</code> event will be also fired, prior to another
                    <code>streamAdded</code> event with the new instance.
                </span>
            </div>
            <h1 class="mt-5" id="stream-display">
                Stream display
            </h1>
            <p>
                In order to display or remove media element in DOM, you can use our helpers:
            </p>
            <ul>
                <li>
                    addInDiv() and removeFromDiv() to work within an element
                </li>
                <li>
                    <code>Stream.attachToElement(domElement)</code> to directly attach to a <code>&lt;video&gt;</code>
                    element.
                </li>
            </ul>
            <p>
                We manage some devices specificities in our helpers that can help avoid media plays issue for instance
                with Safari iOS.
            </p>
            <app-codenav [lang]="lang" [code]="displayStream" (onLang)="lang=$event"></app-codenav>
            <h1 class="mt-5" id="stream-capabilities">
                Stream capabilities
            </h1>
            <p><code>Stream.getCapabilities()</code> method gathers informations on the <strong>media stream</strong>.
            </p>
            <p>TODO: explain what this methods does exactly... does it take information on the video track only ?</p>
            <div class="alert alert-warning" role="alert">
                This method may not work with all browsers!
            </div>
            <p>Here is an example of the object returned (on Chrome):</p>
            <pre><code [highlight]="getCapabilities" [languages]="['json']"></code></pre>
            <h1 class="mt-5" id="qos-statistics">
                QoS statistics
            </h1>
            <p>
                <code>Conversation</code> event <code>callStatsUpdate</code> provides statistics informations on
                <strong>media stream</strong> exchanges quality of service.
            </p>
            <app-codenav [lang]="lang" [code]="callStatsUpdate" (onLang)="lang=$event"></app-codenav>
            <p>
                Depending on whether the stream is <strong>sent</strong> or <strong>received</strong>, the event data
                object (<code>callStats</code>) holds the following informations:
            </p>
            <div class="row">
                <div class="col">
                    <p class="text-center">
                        For a <strong>local stream</strong>, qos info on sent media
                    </p>
                    <pre><code [highlight]="stats_sent" [languages]="['json']"></code></pre>
                </div>
                <div class="col">
                    <p class="text-center">
                        For a <strong>remote stream</strong>, qos info on received media
                    </p>
                    <pre><code [highlight]="stats_received" [languages]="['json']"></code></pre>
                </div>
            </div>
            <p>
                The <code>callStats.streamId</code> is useful to associate data to corresponding
                <strong>stream</strong>.
            </p>
            <h1 class="mt-5" id="speaker-detection">
                Speaker detection
            </h1>
            <p>
                To display which participant is currently talking in a <code>Conversation</code>, enable the feature:
            </p>
            <app-codenav [lang]="lang" [code]="enableActiveSpeakerDetecting" (onLang)="lang=$event"></app-codenav>
            <p>
                Then, listen on the <code>audioAmplitude</code> event:
            </p>
            <app-codenav [lang]="lang" [code]="audioAmplitude" (onLang)="lang=$event"></app-codenav>
            <p>
                the event data object (<code>amplitudeInfo</code>) holds the following informations:
            </p>
            <pre><code [highlight]="amplitudeInfo" [languages]="['json']"></code></pre>
            <p>
                When the participant speaks and <code>amplitude</code> goes over the <code>threshold</code> configured
                during feature enabling, event with <code>isSpeaking</code> set to <strong>true</strong> is fired.
            </p>
            <p>
                When the participant does not speak anymore, the event is fired again with intitial
                <code>amplitude</code> value that triggered the event, but this time <code>isSpeaking</code> is
                <strong>false</strong>.
            </p>
            <h1 class="mt-5" id="mute">
                Video/Audio Mute
            </h1>
            <p>
                Explain Mute
            </p>
            <h1 class="mt-5" id="whiteboard">
                Whiteboard
            </h1>
            <p>
                Explain Whiteboard
            </p>
            <h1 class="mt-5" id="recording">
                Recording
            </h1>
            <p>
                Explain recording
            </p>
            <p>
                Recording locally one stream...
            </p>
            <p>
                Recording conversation : composite media file is stored on ApiRTC servers...
            </p>
            <h1 class="mt-5" id="chat-messages">
                Chat messages
            </h1>
            <p>
                Explain Chat messages
            </p>
            <h1 class="mt-5" id="device-control">
                Device Control
            </h1>
            <p>
                Explain Device Control for local and remote, things you can do, how to do it
            </p>
            <h1 class="mt-5" id="background-subtraction">
                Background subtraction
            </h1>
            <p>
                Explain Background subtraction, blur, transparent, image...
            </p>
            <h1 class="mt-5" id="good-practices">
                Good practices
            </h1>
            <p>
                Explain Good practices
            </p>
        </div>
    </div>
</div>