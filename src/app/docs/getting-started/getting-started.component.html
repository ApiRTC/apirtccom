<div class="container">

    <div class="row justify-content-center mt-5">
        <div class="col-8 fs-6">
            <h1>ApiRTC main and concepts and Classes</h1>
            <ul>
                <li>First, each instance of client application instanciates one <code>UserAgent</code> representing the local individual.
                </li>
                <li>In a <code>Conversation</code>, individuals can <strong>chat</strong>, <strong>watch</strong>,
                    <strong>listen</strong> and/or <strong>share</strong>&nbsp;<strong>real-time audio, video, data,
                        screen...</strong>
                </li>
                <li>A <code>Contact</code> represents a peer individual.</li>
                <li>A <code>Stream</code> is audio, and/or video captured from sources available from browser and published on a
                    <code>Conversation</code>.
                </li>
                <li>A <code>Session</code> must be opened with <strong>ApiRTC</strong>'s servers to create a
                    <code>Conversation</code> to which individuals can join.
                </li>
            </ul>
        </div>
    </div>

    <br>
    <br>
    <!-- <h1 class="mt-5">Get Started !</h1> -->

    <h2>Load ApiRTC library</h2>

    <mat-tab-group animationDuration="0ms">
        <mat-tab label="Angular">
            <div class="card">
                <div class="card-body">
                    <p>In your project directory, run :</p>
                    <p><code>npm install @apizee/apirtc@latest --save</code></p>
                    <p>In
                        <code>angular.json</code> add script :
                    </p>
                    <pre>
            <code>
            {{ '{' }}
                ...
                "projects": {{ '{' }}
                    "YOUR_PROJECT_NAME": {{ '{' }}
                        ...
                        "architect": {{ '{' }}
                            "build": {{ '{' }}
                                ...
                                "options": {{ '{' }}
                                    ...
                                    "scripts": [
                                        "node_modules/@apizee/apirtc/apiRTC.min.js"
            </code>
                </pre>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="ReactJS">
            <div class="card">
                <div class="card-body">
                    <p>In your project directory, run :</p>
                    <p><code>npm install @apizee/apirtc@latest --save</code></p>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="VueJS">
            <div class="card">
                <div class="card-body">
                    <p>In your project directory, run :</p>
                    <p><code>npm install @apizee/apirtc@latest --save</code></p>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="JS">
            <div class="card">
                <div class="card-body">
                    <p>Just add :
                    </p>
                    <p><code>&lt;script type="text/javascript" src="https://cloud.apirtc.com/apiRTC/apiRTC-latest.min.js"&gt;&lt;/script&gt;</code>
                    </p>
                    <!-- <code>&lt;head&gt;...&lt;/head&gt;</code> tags of <code>index.html</code> -->
                    <p>inside <code>&lt;head&gt;...&lt;/head&gt;</code> tag of <code>.html</code> document.</p>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>
    <br>

    <p class="alert alert-info" role="alert">The <strong>ApiRTC</strong> api reference can be found at <a href="https://dev.apirtc.com/api/reference" target="_blank">https://dev.apirtc.com/api/reference</a></p>

    <h2>UserAgent</h2>

    <p>As the entry point to <strong>ApiRTC</strong>, <code>UserAgent</code> is instanciated using the
        <strong>apiKey</strong> associated to your <strong>enterprise</strong> account on <a href="https://www.apirtc.com" target="_blank">https://www.apirtc.com</a>.
    </p>

    <p class="alert alert-info" role="alert">Get your <strong>apiKey</strong> from <a href="https://cloud.apirtc.com/enterprise/api" target="_blank">https://cloud.apirtc.com/enterprise/api</a>
    </p>

    <p class="text-center"><img src="assets/apirtc_useragent.svg" alt="image"></p>

    <mat-tab-group animationDuration="0ms">
        <mat-tab label="Angular & JS">
            <div class="card">
                <div class="card-body">
                    <p><code>declare var apiRTC: any;</code></p>
                    <p><code>
                        userAgent = new apiRTC.UserAgent(&#123;uri: 'apzkey:' + apiKey&#125;);
                    </code></p>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="React/Vue">
            <div class="card">
                <div class="card-body">
                    <p><code>
                        import &#123; UserAgent &#125; from '@apizee/apirtc';
                        </code>
                    </p>
                    <p><code>
                        const userAgent = new UserAgent(&#123;uri: 'apzkey:' + apiKey&#125;);
                    </code></p>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="Kotlin">
            <div class="card">
                <div class="card-body">
                    <p><code>
                        import com.apizee.apiRTC.*
                    </code>
                    </p>
                    <p><code>
                        val optionsUa = UserAgent.UserAgentOptions(uri = "apzkey:$apiKey")<br>
                        val ua = UserAgent(this, optionsUa)
                    </code>
                    </p>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="Swift">
            <div class="card">
                <div class="card-body">
                    <p><code>
                        import ApiRTCSDK
                    </code>
                    </p>
                    <p><code>
                        var ua: UserAgent?<br>
                        ua = UserAgent(UserAgentOptions(uri: .apizee(login)))
                    </code>
                    </p>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>

    <!-- <pre class="border"></pre> -->
    <!-- 
    <p><code>UserAgent</code> permet d'accèder aux fonctionnalités <strong>non-connectées</strong> d'<strong>ApiRTC</strong>.
                    </p>
                    <p>TODO : list non-connected features</p>
                    <ul>
                        <li></li>
                    </ul> -->

    <h2>Stream</h2>

    <p>When <code>UserAgent.createStream</code> is called, a popup opens in the browser to request user acceptance for using media devices. Then it provides an instance of <code>Stream</code>, which carries media
        <strong>stream</strong> from computer device through the browser.
    </p>

    <p>The method <code>Stream.attachToElement</code> binds the <strong>stream</strong> to a DOM
        <code>&lt;video&gt;</code> element in order to display it in the web page.
    </p>

    <p class="text-center"><img src="assets/apirtc_createstream.svg" alt="image"></p>


    <mat-tab-group animationDuration="0ms">
        <mat-tab label="JS">
            <div class="card">
                <div class="card-body">
                    <p><code>
                        userAgent.createStream(&#123;audio: true,video: true&#125;).then(stream => &#123;stream.attachToElement(domElement)&#125;);
                    </code></p>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>


    <h2>Session</h2>

    <p>To use <strong>ApiRTC</strong>'s connected features, a <code>userAgent</code> must register to get a
        <strong>session</strong>. This can be done with or without authentication.
    </p>
    <!-- <p>TODO: lister les modes d'authentification, ou faire un lien vers un chapitre dédié</p> -->

    <p>Simply using <code>UserAgent.register</code> without authentication details registers a
        <code>userAgent</code> with
        <strong>ApiRTC</strong>'s servers without authentication.
    </p>

    <p class="text-center"><img src="assets/apirtc_useragent_register.svg" alt="image"></p>

    <mat-tab-group animationDuration="0ms">
        <mat-tab label="JS">
            <div class="card">
                <div class="card-body">
                    <p><code>
                        userAgent.register().then(session => &#123;...&#125;);
                    </code></p>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>

    <p>The <code>session</code> grants access to connected features such like <strong>conversations</strong> or
        <strong>conferences</strong>.
    </p>

    <h2>Conversation</h2>
    <p>An instance of <code>Conversation</code> is obtained from <code>Session.getOrCreateConversation</code>.
    </p>

    <p class="text-center"><img src="assets/apirtc_session_getOrCreateConversation.svg" alt="image"></p>

    <mat-tab-group animationDuration="0ms">
        <mat-tab label="JS">
            <div class="card">
                <div class="card-body">
                    <p><code>
                        conversation = session.getOrCreateConversation("MY_CONVERSATION");
                    </code></p>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>

    <!-- note : this is weird : conversation.join()-->
    <!-- could we make something easier to explain in the future : participant.join(conversationId) ? -->
    <p>Calling <code>Conversation.join</code> makes the <code>userAgent</code> used to create the
        <code>Session</code> used to create this instance of
        <code>Conversation</code> (through it's <code>Session</code>) join the
        <strong>conversation</strong>.
        <!-- The <code>userAgent</code> then becomes a <strong>participant</strong>. -->
    </p>

    <p class="text-center"><img src="assets/apirtc_conversation_join.svg" alt="image"></p>

    <mat-tab-group animationDuration="0ms">
        <mat-tab label="JS">
            <div class="card">
                <div class="card-body">
                    <p><code>
                        conversation.join();
                    </code></p>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>

    <!-- TODO : this is weird again, now this is the conversation that actually wears the publish method -->
    <p>Once a <strong>conversation</strong> joined, a <code>userAgent</code> can publish a
        <strong>stream</strong> using <code>Conversation.publish</code> method :
    </p>

    <p class="text-center"><img src="assets/apirtc_conversation_publish.svg" alt="image"></p>

    <mat-tab-group animationDuration="0ms">
        <mat-tab label="JS">
            <div class="card">
                <div class="card-body">
                    <code>
                        conversation.publish(stream).then(stream => &#123;...&#125;);
                    </code>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>

    <!-- TODO : All that is weird and should be simplified -->
    <p>Subscribing to peer <strong>streams</strong> shall be implemented as followed :</p>
    <ul>
        <li>
            <p>Listen on <code>Conversation</code>&nbsp;<code>'streamListChanged'</code> event to get notified of
                <strong>streams</strong> published to the
                <strong>conversation</strong>. The data provided by the event is a
                <code>StreamInfo</code> : It gives information on <strong>streams</strong> published in the conversation such as the id (<code>StreamInfo.streamId</code>) of the <strong>stream</strong>.
                <code>StreamInfo.listEventType</code> property tells whether the event is triggered for and addition (value
                <code>'added'</code>) or a removal.
            </p>

        </li>
        <li>
            <p>Calling <code>conversation.subscribeToStream</code> with the <code>StreamInfo.streamId</code> of an 'added' remote stream makes this
                <strong>conversation</strong> subscribe to a
                <strong>stream</strong>.
            </p>
        </li>
        <li>
            <p>Finally, listening on <code>Conversation</code>&nbsp;<code>'streamAdded'</code> notifies with a
                <code>Stream</code> instance which can be attached to web page for display.
            </p>
        </li>
    </ul>

    <p class="text-center"><img src="assets/apirtc_conversation_subscribe.svg" alt="image"></p>

    <mat-tab-group animationDuration="0ms">
        <mat-tab label="JS">
            <div class="card">
                <div class="card-body">
                    <code><pre>
                    conversation.on('streamListChanged', streamInfo => (&#123;
                        if (streamInfo.isRemote === true) &#123;
                            if (streamInfo.listEventType === 'added') &#123;
                                conversation.subscribeToStream(streamInfo.streamId);
                                ...
                    &#125;);
                    conversation.on('streamAdded', stream => (&#123;
                        stream.attachToElement(domElement)
                    &#125;);</pre></code>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>

    <p>At this stage, the application displays both yours and peers video <strong>streams</strong> in the page !
    </p>

    <p>This process is important because a <strong>stream</strong> published to a conversation can be restarted for various technical reasons. In this case the
        <code>'streamListChanged'</code> won't be fired ; but the <code>'streamRemoved'</code> event will be fired with corresponding
        <code>Stream</code> instance, and a <code>'streamAdded'</code> with the new instance will follow, allowing to display correct <strong>stream</strong>.
    </p>

    <p>It is then important to listen on <code>'streamRemoved'</code> to undisplay the corresponding
        <code>Stream</code>.
    </p>

    <p>Handling the remote <code>streamInfo.listEventType === 'removed'</code> is important to get notified that a stream is not published anymore // TODO shal I unsubscribeToStream(streamId) ??

    </p>


    <!-- TODO : provide a simple sample for each framework -->
    <p class="alert alert-info" role="alert">
        Please find full code of examples demonstrating theses concepts on <a href="https://github.com/apizee/ApiRTC-examples" target="_blank">pure JS</a>,
        <a href="https://github.com/kmoyse-apizee/ApiRTC-ng-demo" target="_blank">Angular</a>, <a>React</a>.
    </p>



    <!-- TODO IDEA : -->
    <!-- Faire une documentation v5 qui correspondrait à ce que cela pourrait etre pour etre plus simple
    UserAgent -> Participant
    Session n'existe plus
    On crée une Conversation depuis un autre point d'entrée ?
    les events de converation sont revus pour ne pas avoir streamListChanged puis streamAdded, on aurait plutot participantJoined et sur participant récupéré streamAdded -->


    <!-- 
    <h3>Conference</h3>
    <p>La conférence est une conversation avec la possibilité d'avoir un modérateur qui doit être un utilisateur géré par ApiRTC.</p> -->


</div>